// default config file for ndnrtc headless client

// general parameters
general = {
    log_level = "default";  // all, debug, stat, default, none
    log_file = "ndnrtc-client.log";
    log_path = "/tmp";

    use_fec = true; // [true | false] -- use Forward Error Correction
    use_avsync = true; // [true | false] -- enable synchronization between audio/video streams

    consumer_use_rtx = true; // [true | false] -- reissue timed out interests (late data cases)
    consumer_playback_skip_incomplete = true; // [true | false] -- indicates, whether incomplete frames should be skipped for playback
    
    ndnnetwork ={
        connect_host = "localhost";
        connect_port = 6363;
    };
};

// configuration for streams that will be published
produce = {
    basic = {
        username = "clientA";
        prefix = "/ndn/edu/ucla/remap";
    };
    streams = ({
        type = "video";             // [video | audio] 
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientA"; // session prefix: <producer's publishing prefix> + "ndnrtc/user" + <producer's username>
        name = "camera";            // video stream name
        segment_size = 1000;        // in bytes
        freshness = 2000;           // in milliseconds
        source = "camera.argb";     // file from where raw frames will 
                                    // be read. frame resolution should be
                                    // equal to the maximum encoding resolution 
                                    // among threads
        sync = "sound";
        threads = ({    // an array of stream's all threads that will be published
            name = "low";                       // thread name
            coder = {                           // encoder parameters
                frame_rate = 30;
                gop = 30;                       //group of picture
                start_bitrate = 1000;
                max_bitrate = 10000;
                encode_height = 405;
                encode_width = 720;
                drop_frames = true;     // whether encoder should drop frames
                                        // to maintain start bitrate
            };
        },
        {
            name = "hi";
            coder = {
                frame_rate = 30;
                gop = 30;
                start_bitrate = 3000;
                max_bitrate = 10000;
                encode_height = 1080;
                encode_width = 1920;
                drop_frames = true;
            };
        });
    },
    {
        type = "video";
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientA";
        name = "desktop";
        segment_size = 1000;
        source = "desktop.argb";
        sync = "sound";
        freshness = 2000;
        threads = ({
            name = "mid";
            coder = {
                frame_rate = 30;
                gop = 30;
                start_bitrate = 1000;
                max_bitrate = 10000;
                encode_height = 720;
                encode_width = 1080;
                drop_frames = true;
            };
        },
        {
            name = "low";
            coder = {
                frame_rate = 30;
                gop = 30;
                start_bitrate = 300;
                max_bitrate = 10000;
                encode_height = 288;
                encode_width = 352;
                drop_frames = true;
            };
        });
    },
    {
        type = "audio";
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientA";
        name = "sound";
        thread = "pcmu";
        segment_size = 1000;
        freshness = 2000;           // in milliseconds
    });
};

// configuration for streams that will be fetched
consume = {
    basic = {
        audio = {
            interest_lifetime = 2000; // in millisecond
            jitter_size = 150; // minimal jitter buffer size in milliseconds
            buffer_size = 150; // buffer size in slots
            slot_size = 4000; // frame buffer's slot size in bytes (for assembling frames fetched from network)
        };
        video = {
            interest_lifetime = 2000;
            jitter_size = 150;
            buffer_size = 200;
            slot_size = 16000;
        };
        // statistics to gather per stream
        // allowed statistics keywords can be found in statistics.h
        stat_gathering = ({
            name="buffer";  // file name prefix (complete filename will be 
                            // <name>-<producer_name>-<stream_name>.stat)
            statistics= ("jitterPlay", "jitterTar", "dArr"); 
        },
        {
            name="playback";
            statistics= ("framesAcq","lambdaD","drdPrime");
        },
        {
            name="play";
            statistics= ("lambdaD","drdPrime","jitterTar","dArr");
        });
    };

    streams = ({
        type = "video";             // [video | audio] 
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientB"; // session prefix: <producer's publishing prefix> + "ndnrtc/user" + <producer's username>
        name = "camera";            // video stream name
        thread_to_fetch = "low";    // exact stream thread to fetch from
                                    // should be the name of one thread in this stream
        segment_size = 1000;        // in bytes
        sink = "clientB-camera";    // file path where raw decoded frames 
                                    // will be stored (without extension)
                                    // full filename will be:
                                    //      "<sink>-<idx>-<W>x<H>.argb"
                                    // idx is required, as during fetching, 
                                    // consumer may receive different frame 
                                    // resolutions (due to ARC switching between
                                    // differen threads)
        sync = "sound";             // audio stream for synchornization (audio stream should have same session prefix)
        threads = ({    // an array of stream's all threads published by producer
            name = "low";                       // thread name
            average_segnum_delta = 5;           // average number of segments for 
                                                // delta frames
            average_segnum_delta_parity = 2;    // average number of segments for
                                                // delta parity data 
            average_segnum_key = 30;            // average number of segments for 
                                                // key frames
            average_segnum_key_parity = 5       // average number of segments for 
                                                // key parity data
            coder = {                           // decoder parameters, should be 
                                                // identical to producer's coder
                                                // parameteres
                frame_rate = 30;
                gop = 30;                       //group of picture
                start_bitrate = 1000;
                max_bitrate = 10000;
                encode_height = 405;
                encode_width = 720;
            };
        },
        {
            name = "hi";
            average_segnum_delta = 5;
            average_segnum_delta_parity = 2;
            average_segnum_key = 30;
            average_segnum_key_parity = 6
            coder = {
                frame_rate = 30;
                gop = 30;//group of picture
                start_bitrate = 3000;
                max_bitrate = 10000;
                encode_height = 1080;
                encode_width = 1920;
            };
        });
    },
    {
        type = "video";
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientC";
        name = "camera";
        thread_to_fetch = "mid";
        segment_size = 1000;
        sink = "clientC-camera";
        sync = "sound";
        threads = ({
            name = "mid";
            average_segnum_delta = 5;
            average_segnum_delta_parity = 2;
            average_segnum_key = 30;
            average_segnum_key_parity = 5
            coder = {
                frame_rate = 30;
                gop = 30;
                start_bitrate = 1000;
                max_bitrate = 10000;
                encode_height = 720;
                encode_width = 1080;
            };
        },
        {
            name = "low";
            average_segnum_delta = 5;
            average_segnum_delta_parity = 2;
            average_segnum_key = 30;
            average_segnum_key_parity = 3
            coder = {
                frame_rate = 30;
                gop = 30;
                start_bitrate = 300;
                max_bitrate = 10000;
                encode_height = 288;
                encode_width = 352;
            };
        });
    },
    {
        type = "audio";
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientB";
        name = "sound";
        thread_to_fetch = "pcmu";
        segment_size = 1000;
    },
    {
        type = "audio";
        session_prefix = "/ndn/edu/ucla/remap/ndnrtc/user/clientC";
        name = "sound";
        thread_to_fetch = "pcmu";
        segment_size = 1000;
    });
};
